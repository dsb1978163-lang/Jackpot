<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DonutSMP ¬∑ JACKPOT</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Oswald:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --green:       #0a4a1a;
      --green-mid:   #0f6b28;
      --green-bright:#1aab42;
      --green-neon:  #00ff7f;
      --gold:        #d4a017;
      --gold-bright: #f5c842;
      --gold-pale:   #fef3a8;
      --cream:       #f5edd6;
      --ink:         #1a1208;
      --felt:        #0d3d18;
      --panel-bg:    rgba(8, 28, 12, 0.95);
      --border-gold: rgba(212, 160, 23, 0.35);
      --border-green: rgba(26, 171, 66, 0.3);
      --red:         #cc2233;
      --cyan:        #00e8d4;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Oswald', sans-serif;
      background: #030d06;
      color: var(--cream);
      min-height: 100vh;
      overflow-x: hidden;
      overflow-y: hidden;
      height: 100vh;
    }

    /* ‚îÄ‚îÄ FELT TEXTURE BACKGROUND ‚îÄ‚îÄ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 120% 80% at 50% 0%, rgba(15,107,40,0.18) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 20% 100%, rgba(10,74,26,0.2) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(10,74,26,0.2) 0%, transparent 50%),
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(0,255,127,0.012) 2px,
          rgba(0,255,127,0.012) 3px
        ),
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 2px,
          rgba(0,255,127,0.008) 2px,
          rgba(0,255,127,0.008) 3px
        );
      z-index: 0;
    }

    /* Dollar bill engraving pattern overlay */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 40px,
          rgba(212,160,23,0.015) 40px,
          rgba(212,160,23,0.015) 41px
        ),
        repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 40px,
          rgba(212,160,23,0.015) 40px,
          rgba(212,160,23,0.015) 41px
        );
      z-index: 0;
    }

    /* ‚îÄ‚îÄ FLOATING BILLS BG ‚îÄ‚îÄ */
    #bills-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .bill-particle {
      position: absolute;
      opacity: 0;
      font-size: 1.4rem;
      animation: billFloat var(--dur) var(--delay) ease-in-out infinite;
      filter: drop-shadow(0 0 4px rgba(26,171,66,0.3));
    }
    @keyframes billFloat {
      0%   { transform: translateY(110vh) rotate(-15deg); opacity: 0; }
      8%   { opacity: 0.25; }
      92%  { opacity: 0.1; }
      100% { transform: translateY(-10vh) rotate(15deg); opacity: 0; }
    }

    .page {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 8px 20px 210px;
      gap: 8px;
      max-width: 1600px;
      overflow: hidden;
      margin: 0 auto;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      text-align: center;
      padding: 2px 0 2px;
      position: relative;
    }

    /* Dollar sign watermark behind title */
    .header-watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14rem;
      color: rgba(26,171,66,0.04);
      font-family: 'Playfair Display', serif;
      font-weight: 900;
      pointer-events: none;
      line-height: 1;
      user-select: none;
      cursor: default;
      z-index: 0;
    }

    .header-rule {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 8px;
    }
    .hr-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--gold), var(--gold-bright), var(--gold), transparent);
      opacity: 0.5;
    }
    .hr-ornament {
      font-size: 1.1rem;
      color: var(--gold-bright);
      filter: drop-shadow(0 0 6px var(--gold));
    }

    .logo-server {
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem;
      letter-spacing: 8px;
      color: var(--green-bright);
      text-transform: uppercase;
      margin-bottom: 4px;
      opacity: 0.7;
    }

    .logo-main {
      font-family: 'Playfair Display', serif;
      font-size: 4rem;
      font-weight: 900;
      letter-spacing: 6px;
      line-height: 1;
      color: var(--gold-bright);
      text-shadow:
        0 0 30px rgba(245,200,66,0.5),
        0 0 80px rgba(245,200,66,0.2),
        2px 2px 0 rgba(0,0,0,0.6);
      position: relative;
    }

    .logo-sub {
      font-family: 'Oswald', sans-serif;
      font-size: 0.65rem;
      letter-spacing: 6px;
      color: rgba(245,237,214,0.35);
      text-transform: uppercase;
      margin-top: 6px;
      font-weight: 400;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(0,0,0,0.5);
      border: 1px solid var(--border-green);
      border-radius: 3px;
      padding: 5px 16px;
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 4px;
      color: var(--green-bright);
      margin-top: 10px;
      text-transform: uppercase;
    }
    .status-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      background: var(--green-neon);
      box-shadow: 0 0 6px var(--green-neon);
      animation: blink 1.4s ease infinite;
    }
    .status-pill.offline { border-color: rgba(204,34,51,0.4); color: rgba(204,34,51,0.7); }
    .status-pill.offline .status-dot { background: var(--red); box-shadow: 0 0 6px var(--red); }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

    /* ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ */
    .controls {
      display: flex;
      gap: 8px;
      justify-content: center;
    }
    .btn {
      font-family: 'Oswald', sans-serif;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 3px;
      padding: 8px 22px;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
    }
    .btn:active { transform: scale(0.97); }

    #startBtn {
      background: linear-gradient(135deg, #0d5c20, #1aab42, #0d5c20);
      background-size: 200% 100%;
      color: var(--cream);
      border: 1px solid rgba(26,171,66,0.7);
      box-shadow: 0 0 20px rgba(26,171,66,0.3), inset 0 1px 0 rgba(255,255,255,0.15);
      animation: greenShimmer 4s linear infinite;
    }
    @keyframes greenShimmer {
      0% { background-position: 100% 0; }
      100% { background-position: -100% 0; }
    }
    #startBtn:hover { box-shadow: 0 0 40px rgba(26,171,66,0.6), inset 0 1px 0 rgba(255,255,255,0.2); }

    #stopBtn {
      background: transparent;
      color: rgba(204,34,51,0.85);
      border: 1px solid rgba(204,34,51,0.4);
      box-shadow: 0 0 8px rgba(204,34,51,0.15);
    }
    #stopBtn:hover { box-shadow: 0 0 20px rgba(204,34,51,0.4); color: var(--red); }

    #autoBtn {
      background: transparent;
      color: var(--gold);
      border: 1px solid var(--border-gold);
      box-shadow: 0 0 8px rgba(212,160,23,0.15);
    }
    #autoBtn:hover { box-shadow: 0 0 20px rgba(212,160,23,0.4); }
    #autoBtn.active {
      background: var(--gold);
      color: #000;
      box-shadow: 0 0 30px rgba(212,160,23,0.7);
      animation: goldPulse 1.8s ease infinite;
    }
    @keyframes goldPulse {
      0%,100% { box-shadow: 0 0 30px rgba(212,160,23,0.7); }
      50%      { box-shadow: 0 0 55px rgba(212,160,23,1); }
    }

    #autoToast {
      position: fixed;
      bottom: 94px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(3,13,6,0.95);
      border: 1px solid var(--border-gold);
      border-radius: 3px;
      padding: 10px 28px;
      font-family: 'DM Mono', monospace;
      font-size: 0.7rem;
      letter-spacing: 2px;
      color: var(--gold-bright);
      z-index: 50;
      display: none;
      white-space: nowrap;
      box-shadow: 0 0 20px rgba(212,160,23,0.25);
    }
    #autoToast.show { display: block; }

    /* ‚îÄ‚îÄ STATS BAR ‚Äî styled like a casino chip tray ‚îÄ‚îÄ */
    .stats-bar {
      display: flex;
      align-items: stretch;
      background: var(--panel-bg);
      border: 1px solid var(--border-gold);
      border-radius: 4px;
      overflow: hidden;
      box-shadow:
        0 0 40px rgba(212,160,23,0.12),
        inset 0 1px 0 rgba(212,160,23,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.5);
      position: relative;
    }
    /* Felt texture on stats bar */
    .stats-bar::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 3px,
        rgba(26,171,66,0.03) 3px,
        rgba(26,171,66,0.03) 4px
      );
      pointer-events: none;
    }
    .stat-block {
      flex: 1;
      text-align: center;
      padding: 10px 12px;
      position: relative;
      z-index: 1;
    }
    .stat-block + .stat-block::before {
      content: '';
      position: absolute;
      left: 0; top: 15%; height: 70%;
      width: 1px;
      background: linear-gradient(180deg, transparent, var(--border-gold), transparent);
    }
    .stat-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.55rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(212,160,23,0.45);
      margin-bottom: 6px;
    }
    .stat-value {
      font-family: 'Playfair Display', serif;
      font-size: 2.2rem;
      line-height: 1;
      font-weight: 700;
    }
    #timer { color: var(--cyan); text-shadow: 0 0 20px rgba(0,232,212,0.6); }
    #pot   { color: var(--gold-bright); text-shadow: 0 0 20px rgba(245,200,66,0.6); }
    #playerCount { color: var(--green-neon); text-shadow: 0 0 15px rgba(0,255,127,0.5); }
    #timer.danger  { color: #ff5566; text-shadow: 0 0 20px #ff5566; animation: timerFlash 0.8s ease infinite; }
    #timer.cutoff  { color: #fff; text-shadow: 0 0 30px #ff3344, 0 0 60px #ff3344; animation: timerFlash 0.3s ease infinite; }
    #timer.lobby   { color: rgba(212,160,23,0.4); text-shadow: none; font-size:1.6rem; padding-top:6px; font-family:'DM Mono',monospace; letter-spacing:4px; }
    @keyframes timerFlash { 0%,100%{opacity:1} 50%{opacity:0.5} }

    /* ‚îÄ‚îÄ PLAYER PANEL ‚îÄ‚îÄ */
    .player-panel {
      background: var(--panel-bg);
      border: 1px solid var(--border-gold);
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
      flex: 1;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      padding: 10px 18px;
      border-bottom: 1px solid var(--border-gold);
      font-family: 'DM Mono', monospace;
      font-size: 0.55rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(212,160,23,0.45);
      background: rgba(212,160,23,0.04);
    }
    .player-scroll-wrap {
      height: 380px;
      overflow: hidden;
      position: relative;
    }
    .player-scroll-wrap::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 70px;
      background: linear-gradient(transparent, rgba(3,13,6,0.98));
      pointer-events: none;
      z-index: 2;
    }
    .player-list { padding: 6px 0; }
    .player-list.animated {
      animation: scrollList var(--scroll-dur, 20s) linear infinite;
    }
    @keyframes scrollList {
      0%   { transform: translateY(0); }
      100% { transform: translateY(var(--scroll-height, -50%)); }
    }
    .player-row {
      display: flex;
      align-items: center;
      padding: 10px 16px 10px 14px;
      border-bottom: 1px solid rgba(26,171,66,0.07);
      transition: background 0.2s;
      min-height: 58px;
      gap: 0;
    }
    .player-row:hover { background: rgba(26,171,66,0.04); }
    .player-rank {
      font-family: 'DM Mono', monospace;
      font-size: 0.7rem;
      color: rgba(212,160,23,0.3);
      width: 20px;
      flex-shrink: 0;
      text-align: center;
    }
    .player-skin {
      width: 40px; height: 40px;
      border-radius: 4px;
      border: 1px solid rgba(212,160,23,0.2);
      image-rendering: pixelated;
      flex-shrink: 0;
      margin: 0 12px;
    }
    .player-info { flex: 1; min-width: 0; }
    .player-name {
      font-family: 'Oswald', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      color: var(--cream);
      line-height: 1.2;
      white-space: nowrap;
      overflow: visible;
    }
    .player-amount {
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem;
      color: rgba(26,171,66,0.7);
      font-weight: 400;
    }
    .player-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
      margin-left: 14px;
    }
    .player-bar-wrap {
      width: 72px; height: 4px;
      background: rgba(26,171,66,0.1);
      border-radius: 2px;
      overflow: hidden;
    }
    .player-bar {
      height: 100%;
      border-radius: 2px;
      transition: width 0.6s ease;
    }
    .player-pct {
      font-family: 'DM Mono', monospace;
      font-size: 0.8rem;
      font-weight: 500;
      width: 46px;
      text-align: right;
    }

    /* ‚îÄ‚îÄ NEXT QUEUE ‚îÄ‚îÄ */
    #nextQueuePanel {
      background: rgba(3,13,6,0.9);
      border: 1px solid rgba(212,160,23,0.2);
      border-radius: 4px;
      padding: 12px 18px;
    }

    /* ‚îÄ‚îÄ LOBBY LAYOUT ‚îÄ‚îÄ */
    .lobby-layout {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex: 1;
    }

    .lobby-wheel-wrap {
      position: relative;
      flex-shrink: 0;
    }
    .lobby-wheel-stage {
      position: relative;
      width: 480px;
      height: 480px;
    }
    .lobby-wheel-ring {
      position: absolute;
      inset: 10px;
      border-radius: 50%;
      border: 3px solid var(--gold);
      box-shadow:
        0 0 25px rgba(212,160,23,0.4),
        0 0 60px rgba(212,160,23,0.15),
        inset 0 0 25px rgba(0,0,0,0.5);
      pointer-events: none;
      z-index: 2;
    }
    /* Rotating dashed ring */
    .lobby-wheel-stage::before {
      content: '';
      position: absolute;
      inset: -5px;
      border-radius: 50%;
      border: 1px dashed rgba(212,160,23,0.3);
      animation: ringRotate 18s linear infinite;
      z-index: 1;
    }
    /* Outer dots ring */
    .lobby-wheel-stage::after {
      content: '';
      position: absolute;
      inset: -14px;
      border-radius: 50%;
      border: 2px dotted rgba(26,171,66,0.2);
      animation: ringRotate 30s linear infinite reverse;
      z-index: 1;
    }
    @keyframes ringRotate {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
    #lobbyCanvas {
      position: absolute;
      inset: 16px;
      border-radius: 50%;
      z-index: 3;
    }
    .lobby-wheel-center {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      width: 130px; height: 130px;
      border-radius: 50%;
      background: radial-gradient(circle, #081a0a 0%, #040e06 70%, #000 100%);
      border: 2px solid rgba(212,160,23,0.3);
      box-shadow: 0 0 30px rgba(0,0,0,0.9), inset 0 0 20px rgba(0,0,0,0.5);
      z-index: 8;
    }
    #lobbyCenterLabel {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      text-align: center;
      z-index: 9;
      pointer-events: none;
      width: 88px;
    }
    .wcl-title {
      font-family: 'Playfair Display', serif;
      font-size: 0.6rem;
      letter-spacing: 2px;
      color: var(--gold);
      text-shadow: 0 0 8px rgba(212,160,23,0.9);
      text-transform: uppercase;
    }
    .wcl-pot {
      font-family: 'DM Mono', monospace;
      font-size: 0.75rem;
      color: rgba(26,171,66,0.9);
      text-shadow: 0 0 6px rgba(26,171,66,0.5);
    }

    #lobbyBubbles {
      position: absolute;
      inset: 0;
      z-index: 10;
      pointer-events: none;
    }
    .lobby-bubble {
      position: absolute;
      display: flex;
      align-items: center;
      gap: 7px;
      background: rgba(4, 16, 7, 0.92);
      border: 1px solid rgba(212,160,23,0.25);
      border-radius: 4px;
      padding: 6px 10px 6px 10px;
      transform: translate(-50%, -50%);
      white-space: nowrap;
      box-shadow: 0 4px 20px rgba(0,0,0,0.7), 0 0 10px rgba(212,160,23,0.08);
      transition: opacity 0.4s;
    }
    .lb-skin {
      width: 30px; height: 30px;
      border-radius: 3px;
      image-rendering: pixelated;
      border: 1px solid rgba(212,160,23,0.2);
      flex-shrink: 0;
    }
    .lb-info { display: flex; flex-direction: column; }
    .lb-name { font-family: 'Oswald', sans-serif; font-weight: 600; font-size: 0.82rem; color: var(--cream); line-height: 1.2; }
    .lb-amount { font-size: 0.65rem; color: rgba(26,171,66,0.75); font-family: 'DM Mono', monospace; }
    .lb-pct { font-family: 'DM Mono', monospace; font-weight: 500; font-size: 0.82rem; margin-left: 4px; }

    .lobby-empty {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      color: rgba(212,160,23,0.2);
      position: absolute;
      inset: 0;
    }
    .lobby-empty.show { display: flex; }
    .empty-icon { font-size: 2.8rem; }
    .empty-text {
      font-family: 'DM Mono', monospace;
      font-size: 0.7rem;
      letter-spacing: 4px;
      text-transform: uppercase;
    }

    .lobby-right-panel {
      flex: 1;
      min-width: 0;
    }

    /* ‚îÄ‚îÄ CMD BAR ‚îÄ‚îÄ */
    /* Music bar sits fixed directly above cmd-bar */
    .music-bar-fixed {
      position: fixed;
      bottom: 100px;
      left: 0; right: 0;
      z-index: 11;
      background: rgba(3,13,6,0.97);
      border-top: 1px solid var(--border-gold);
      padding: 13px 30px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: 0 -2px 20px rgba(0,0,0,0.4);
    }
    .music-bar-fixed::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--green-bright), var(--gold-bright), var(--green-bright), transparent);
      opacity: 0.4;
    }
    .cmd-bar {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: rgba(3,13,6,0.97);
      border-top: 1px solid var(--border-gold);
      padding: 18px 20px;
      text-align: center;
      z-index: 10;
      box-shadow: 0 -4px 30px rgba(0,0,0,0.6);
    }
    /* Green felt strip at top of cmd bar */
    .cmd-bar::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--green-bright), var(--gold-bright), var(--green-bright), transparent);
      opacity: 0.5;
    }
    .cmd-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.7rem;
      letter-spacing: 6px;
      color: rgba(26,171,66,0.4);
      text-transform: uppercase;
      margin-bottom: 5px;
    }
    .cmd-text {
      font-family: 'Playfair Display', serif;
      font-size: 2.6rem;
      font-weight: 700;
      color: var(--gold-bright);
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(245,200,66,0.5);
    }
    .cmd-text span {
      color: var(--green-neon);
      text-shadow: 0 0 16px rgba(0,255,127,0.6);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       WHEEL OVERLAY ‚Äî spin screen
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    #wheelOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0);
      display: none;
      flex-direction: row;
      gap: 44px;
      padding: 40px;
      align-items: center;
      justify-content: center;
      z-index: 500;
      transition: background 0.5s;
    }
    #wheelOverlay.visible {
      background: rgba(1, 8, 3, 0.97);
    }

    .spin-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.05rem;
      letter-spacing: 3px;
      color: var(--gold);
      margin-bottom: 22px;
      text-transform: uppercase;
      font-style: italic;
      text-shadow: 0 0 12px rgba(212,160,23,0.5);
    }

    .wheel-left-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    .wheel-right-col {
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 370px;
      max-height: 520px;
      overflow-y: auto;
    }
    .wheel-right-col::-webkit-scrollbar { width: 3px; }
    .wheel-right-col::-webkit-scrollbar-track { background: transparent; }
    .wheel-right-col::-webkit-scrollbar-thumb { background: rgba(212,160,23,0.2); border-radius: 2px; }

    .wheel-stage {
      position: relative;
      width: 520px;
      height: 520px;
    }
    .wheel-ring {
      position: absolute;
      inset: 10px;
      border-radius: 50%;
      border: 4px solid var(--gold);
      box-shadow: 0 0 40px rgba(212,160,23,0.5), inset 0 0 40px rgba(0,0,0,0.4), 0 0 80px rgba(212,160,23,0.2);
      pointer-events: none;
    }
    .wheel-stage::before {
      content: '';
      position: absolute;
      inset: -6px;
      border-radius: 50%;
      border: 1px dashed rgba(212,160,23,0.4);
      animation: ringRotate 10s linear infinite;
    }
    #wheelCanvas {
      position: absolute;
      inset: 20px;
      border-radius: 50%;
    }
    .wheel-center {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      width: 128px; height: 128px;
      border-radius: 50%;
      background: radial-gradient(circle, #081a0a 0%, #040d06 70%, #000 100%);
      border: 3px solid rgba(212,160,23,0.35);
      box-shadow: 0 0 30px rgba(0,0,0,0.9), inset 0 0 20px rgba(0,0,0,0.6);
      z-index: 5;
    }
    .wheel-pointer {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      filter: drop-shadow(0 0 8px rgba(212,160,23,0.9));
    }
    #wheelCenterLabel {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      pointer-events: none;
      width: 108px;
    }

    /* Right panel cards */
    .wheel-player-row {
      display: flex;
      align-items: center;
      background: rgba(4, 18, 8, 0.9);
      border: 1px solid rgba(212,160,23,0.12);
      border-radius: 4px;
      overflow: hidden;
      min-height: 60px;
    }
    .wpr-color-bar { width: 4px; align-self: stretch; flex-shrink: 0; }
    .wpr-avatar-wrap {
      width: 50px; height: 60px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      background: rgba(0,0,0,0.3);
    }
    .wpr-skin {
      width: 36px; height: 36px;
      border-radius: 3px;
      image-rendering: pixelated;
      border: 1px solid rgba(212,160,23,0.15);
    }
    .wpr-info { flex: 1; padding: 0 12px; }
    .wpr-name { font-family: 'Oswald', sans-serif; font-weight: 600; font-size: 1rem; color: var(--cream); }
    .wpr-amount { font-family: 'DM Mono', monospace; font-size: 0.78rem; color: rgba(26,171,66,0.7); }
    .wpr-pct {
      font-family: 'DM Mono', monospace;
      font-size: 1.2rem;
      font-weight: 500;
      flex-shrink: 0;
      min-width: 70px;
      text-align: right;
      padding-right: 14px;
    }
    .wheel-right-header {
      display: flex;
      justify-content: space-between;
      font-family: 'DM Mono', monospace;
      font-size: 0.55rem;
      letter-spacing: 4px;
      color: rgba(212,160,23,0.4);
      text-transform: uppercase;
      padding: 0 14px 8px;
    }

    /* Flying bill particles during spin */
    .bill {
      position: fixed;
      font-size: 1.6rem;
      pointer-events: none;
      z-index: 510;
      opacity: 0;
      animation: billFly var(--bd) var(--bdelay) ease-out forwards;
    }
    @keyframes billFly {
      0%   { transform: translate(0,0) rotate(0deg); opacity: 1; }
      100% { transform: translate(var(--bx), var(--by)) rotate(var(--br)); opacity: 0; }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       WINNER REVEAL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    #winnerReveal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 600;
      background: rgba(1,8,3,0.85);
    }
    #winnerReveal.show { display: flex; }

    .winner-card {
      background: linear-gradient(155deg, #040f06, #081a0a, #040f06);
      border: 2px solid var(--gold);
      border-radius: 8px;
      padding: 52px 80px;
      text-align: center;
      box-shadow:
        0 0 80px rgba(212,160,23,0.45),
        0 0 200px rgba(212,160,23,0.12),
        inset 0 0 60px rgba(26,171,66,0.04);
      animation: cardPop 0.5s cubic-bezier(0.175,0.885,0.32,1.275) forwards;
      position: relative;
      overflow: hidden;
    }
    /* Dollar bill border ornament */
    .winner-card::before {
      content: '$ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $';
      position: absolute;
      top: 10px; left: 0; right: 0;
      font-family: 'Playfair Display', serif;
      font-size: 0.65rem;
      letter-spacing: 4px;
      color: rgba(212,160,23,0.12);
      text-align: center;
      pointer-events: none;
    }
    .winner-card::after {
      content: '$ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $ $';
      position: absolute;
      bottom: 10px; left: 0; right: 0;
      font-family: 'Playfair Display', serif;
      font-size: 0.65rem;
      letter-spacing: 4px;
      color: rgba(212,160,23,0.12);
      text-align: center;
      pointer-events: none;
    }
    @keyframes cardPop {
      from { transform: scale(0.5) rotate(-3deg); opacity: 0; }
      to   { transform: scale(1) rotate(0deg);   opacity: 1; }
    }
    .winner-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 6px;
      color: rgba(26,171,66,0.6);
      margin-bottom: 20px;
      text-transform: uppercase;
    }
    .winner-skin-img {
      width: 108px; height: 108px;
      border-radius: 6px;
      border: 2px solid var(--gold);
      image-rendering: pixelated;
      box-shadow: 0 0 30px rgba(212,160,23,0.5), 0 0 60px rgba(26,171,66,0.2);
      margin-bottom: 18px;
    }
    .winner-name {
      font-family: 'Playfair Display', serif;
      font-size: 3rem;
      font-weight: 900;
      color: var(--gold-bright);
      text-shadow: 0 0 30px rgba(245,200,66,0.6), 2px 2px 0 rgba(0,0,0,0.6);
      margin-bottom: 12px;
      letter-spacing: 2px;
    }
    .winner-payout {
      font-family: 'Playfair Display', serif;
      font-size: 2.4rem;
      color: var(--green-neon);
      text-shadow: 0 0 25px rgba(0,255,127,0.7);
      margin-bottom: 8px;
      font-style: italic;
    }
    .winner-pct {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 4px;
      color: rgba(212,160,23,0.3);
      text-transform: uppercase;
    }

    /* REFUND */
    #refundReveal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 600;
      background: rgba(0,0,0,0.85);
    }
    #refundReveal.show { display: flex; }
    .refund-card {
      background: linear-gradient(160deg, #000d0a, #001510, #000d0a);
      border: 2px solid var(--cyan);
      border-radius: 8px;
      padding: 48px 72px;
      text-align: center;
      box-shadow: 0 0 80px rgba(0,232,212,0.3), inset 0 0 40px rgba(0,232,212,0.03);
      animation: cardPop 0.5s cubic-bezier(0.175,0.885,0.32,1.275) forwards;
    }
    .refund-label { font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 6px; color: var(--cyan); margin-bottom: 18px; opacity: 0.7; text-transform: uppercase; }
    .refund-skin { width: 80px; height: 80px; border-radius: 6px; border: 2px solid var(--cyan); image-rendering: pixelated; margin-bottom: 14px; }
    .refund-name { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 700; color: #fff; margin-bottom: 10px; }
    .refund-amount { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-style: italic; color: var(--cyan); text-shadow: 0 0 20px var(--cyan); margin-bottom: 8px; }
    .refund-reason { font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 3px; color: rgba(0,232,212,0.35); text-transform: uppercase; }

    /* CONFETTI */
    /* ‚îÄ‚îÄ WARNING TICKER BANNER ‚îÄ‚îÄ */
    .warning-ticker-wrap {
      position: relative;
      z-index: 2;
      overflow: hidden;
      height: 64px;
      background: repeating-linear-gradient(
        -45deg,
        #cc2233 0px,
        #cc2233 28px,
        #000 28px,
        #000 56px
      );
      border-top: 3px solid rgba(255,60,80,0.85);
      border-bottom: 3px solid rgba(255,60,80,0.85);
      box-shadow: 0 0 28px rgba(204,34,51,0.6), inset 0 0 16px rgba(0,0,0,0.5);
      display: none;
    }
    .warning-ticker-wrap.show { display: block; }
    /* semi-transparent overlay so text pops over stripes */
    .warning-ticker-wrap::before {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.42);
      pointer-events: none;
      z-index: 0;
    }
    .warning-ticker-inner {
      position: absolute;
      top: 0; left: 0;
      display: flex;
      align-items: center;
      height: 100%;
      white-space: nowrap;
      animation: tickerScroll 32s linear infinite;
      z-index: 1;
    }
    .warning-ticker-item {
      font-family: 'Oswald', sans-serif;
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 0 0 14px rgba(255,80,100,1), 0 2px 0 rgba(0,0,0,0.95);
      padding: 0 60px;
    }
    .warning-ticker-item .warn-icon { color: #ffcc00; margin: 0 10px; font-size: 1.5rem; }
    @keyframes tickerScroll {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* Pause button */
    #pauseBtn {
      background: transparent;
      color: var(--cyan);
      border: 1px solid rgba(0,232,212,0.4);
      box-shadow: 0 0 8px rgba(0,232,212,0.15);
    }
    #pauseBtn:hover { box-shadow: 0 0 20px rgba(0,232,212,0.4); }
    #pauseBtn.paused {
      background: rgba(0,232,212,0.15);
      color: #fff;
      border-color: rgba(0,232,212,0.7);
      box-shadow: 0 0 30px rgba(0,232,212,0.5);
      animation: cyanPulse 1.4s ease infinite;
    }
    @keyframes cyanPulse {
      0%,100% { box-shadow: 0 0 30px rgba(0,232,212,0.5); }
      50%      { box-shadow: 0 0 55px rgba(0,232,212,0.9); }
    }

    /* Refund click on player skin */
    .player-skin.refundable {
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s, border-color 0.15s;
    }
    .player-skin.refundable:hover {
      transform: scale(1.18);
      border-color: rgba(204,34,51,0.8);
      box-shadow: 0 0 14px rgba(204,34,51,0.7);
    }
    .player-skin.refundable:active { transform: scale(0.95); }

    /* Refund tooltip hint */
    .player-row { position: relative; }

    /* ‚îÄ‚îÄ Spin wheel ‚Äî reduced size ‚îÄ‚îÄ */
    .wheel-stage {
      width: 480px !important;
      height: 480px !important;
    }
    #wheelCanvas { width: 440px !important; height: 440px !important; }
    .wheel-right-col {
      width: 620px !important;
      max-height: 480px !important;
    }
    .wpr-skin { width: 44px !important; height: 44px !important; }
    .wpr-avatar-wrap { width: 60px !important; height: 68px !important; }
    .wheel-player-row { min-height: 68px !important; }
    .wpr-name { font-size: 1.15rem !important; white-space: nowrap !important; overflow: visible !important; text-overflow: unset !important; }
    .wpr-amount { font-size: 0.88rem !important; }
    .wpr-pct { font-size: 1.2rem !important; min-width: 80px !important; }
    .wpr-info { flex: 1; padding: 0 10px; min-width: 0; overflow: visible !important; }

    /* Lobby wheel ‚Äî matched to base size */
    #lobbyCanvas {
      width: 450px !important;
      height: 450px !important;
    }

    /* Entrants panel ‚Äî narrower horizontally, same vertical length */
    .player-panel { flex: 2 !important; min-width: 0 !important; }
    .player-scroll-wrap { height: 420px !important; }
    .player-skin { width: 36px !important; height: 36px !important; margin: 0 8px !important; }
    .player-name { font-size: 0.95rem !important; white-space: nowrap !important; overflow: visible !important; text-overflow: unset !important; }
    .player-amount { font-size: 0.75rem !important; }
    .player-pct { font-size: 0.88rem !important; width: 52px !important; }
    .player-row { min-height: 52px !important; padding: 8px 12px 8px 10px !important; }
    .player-info { flex: 1; min-width: 0; overflow: visible !important; }
    .player-rank { font-size: 0.65rem !important; width: 18px !important; }
    .player-bar-wrap { width: 70px !important; height: 4px !important; }
    .player-right { gap: 8px !important; margin-left: 10px !important; }
    .panel-header { font-size: 0.58rem !important; letter-spacing: 4px !important; padding: 9px 14px !important; }
    /* Push side panels to the far left */
    .side-panels { margin-right: auto !important; }

    /* ‚îÄ‚îÄ MUSIC PLAYER ‚îÄ‚îÄ */
    .music-icon {
      font-size: 1.4rem;
      flex-shrink: 0;
      filter: drop-shadow(0 0 6px rgba(212,160,23,0.5));
      animation: musicPulse 2s ease infinite;
    }
    .music-icon.playing { animation: musicBounce 0.6s ease infinite alternate; }
    @keyframes musicPulse  { 0%,100%{opacity:1} 50%{opacity:0.5} }
    @keyframes musicBounce { from{transform:scale(1)} to{transform:scale(1.2)} }
    .music-input-wrap { flex: 1; position: relative; }
    .music-input {
      width: 100%;
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(212,160,23,0.25);
      border-radius: 3px;
      padding: 8px 14px;
      font-family: 'DM Mono', monospace;
      font-size: 0.68rem;
      color: var(--cream);
      letter-spacing: 1px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .music-input::placeholder { color: rgba(245,237,214,0.25); }
    .music-input:focus {
      border-color: rgba(212,160,23,0.6);
      box-shadow: 0 0 12px rgba(212,160,23,0.2);
    }
    .music-btn {
      font-family: 'Oswald', sans-serif;
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 2px;
      padding: 8px 18px;
      border-radius: 3px;
      cursor: pointer;
      text-transform: uppercase;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    .music-btn:active { transform: scale(0.96); }
    #musicPlayBtn {
      background: linear-gradient(135deg, #0d5c20, #1aab42, #0d5c20);
      background-size: 200% 100%;
      color: var(--cream);
      border: 1px solid rgba(26,171,66,0.6);
      box-shadow: 0 0 12px rgba(26,171,66,0.25);
      animation: greenShimmer 4s linear infinite;
    }
    #musicPlayBtn:hover { box-shadow: 0 0 25px rgba(26,171,66,0.5); }
    #musicStopBtn {
      background: transparent;
      color: rgba(204,34,51,0.85);
      border: 1px solid rgba(204,34,51,0.35);
    }
    #musicStopBtn:hover { box-shadow: 0 0 14px rgba(204,34,51,0.4); color: var(--red); }
    #musicPauseBtn {
      background: transparent;
      color: var(--cyan);
      border: 1px solid rgba(0,232,212,0.35);
    }
    #musicPauseBtn:hover:not(:disabled) { box-shadow: 0 0 14px rgba(0,232,212,0.4); }
    #musicPauseBtn:disabled { opacity: 0.25; cursor: default; }
    #musicPauseBtn.paused {
      background: rgba(0,232,212,0.12);
      border-color: rgba(0,232,212,0.7);
      color: #fff;
      box-shadow: 0 0 14px rgba(0,232,212,0.35);
    }
    .music-vol-wrap { display: flex; align-items: center; gap: 7px; flex-shrink: 0; }
    .music-vol-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.55rem;
      letter-spacing: 2px;
      color: rgba(212,160,23,0.4);
      text-transform: uppercase;
    }
    .music-vol {
      -webkit-appearance: none;
      appearance: none;
      width: 72px; height: 4px;
      border-radius: 2px;
      background: linear-gradient(90deg, var(--green-bright) var(--vol,70%), rgba(26,171,66,0.15) var(--vol,70%));
      outline: none;
      cursor: pointer;
    }
    .music-vol::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 13px; height: 13px;
      border-radius: 50%;
      background: var(--gold-bright);
      box-shadow: 0 0 6px rgba(212,160,23,0.6);
      cursor: pointer;
    }
    .music-status {
      font-family: 'DM Mono', monospace;
      font-size: 0.58rem;
      letter-spacing: 2px;
      color: rgba(26,171,66,0.5);
      text-transform: uppercase;
      flex-shrink: 0;
      min-width: 52px;
      text-align: right;
    }
    .music-status.active { color: var(--green-neon); text-shadow: 0 0 8px rgba(0,255,127,0.5); }
    #musicFrame { display: none; }

    /* ‚îÄ‚îÄ SIDE PANELS (Last Winner, Biggest Entry, 1B Club) ‚îÄ‚îÄ */
    .side-panels {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 300px;
      flex-shrink: 0;
    }

    .side-panel {
      background: var(--panel-bg);
      border: 1px solid var(--border-gold);
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    .side-panel-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 18px;
      border-bottom: 1px solid var(--border-gold);
      background: rgba(212,160,23,0.04);
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: rgba(212,160,23,0.5);
    }
    .side-panel-header .sp-icon { font-size: 1.1rem; }

    /* Last Winner panel */
    .last-winner-body {
      padding: 22px 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      text-align: center;
    }
    .lw-skin {
      width: 80px; height: 80px;
      border-radius: 6px;
      border: 2px solid var(--gold);
      image-rendering: pixelated;
      box-shadow: 0 0 20px rgba(212,160,23,0.4);
    }
    .lw-name {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold-bright);
      text-shadow: 0 0 12px rgba(245,200,66,0.5);
      line-height: 1.2;
    }
    .lw-payout {
      font-family: 'DM Mono', monospace;
      font-size: 1.1rem;
      color: var(--green-neon);
      text-shadow: 0 0 8px rgba(0,255,127,0.4);
    }
    .lw-entry {
      font-family: 'DM Mono', monospace;
      font-size: 0.78rem;
      color: rgba(245,237,214,0.35);
      letter-spacing: 1px;
    }
    .lw-empty {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 3px;
      color: rgba(212,160,23,0.2);
      text-transform: uppercase;
      padding: 28px 0;
    }

    /* Biggest Entry panel */
    .biggest-entry-body {
      padding: 18px 20px;
    }
    .be-row {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .be-skin {
      width: 64px; height: 64px;
      border-radius: 5px;
      border: 1px solid rgba(212,160,23,0.35);
      image-rendering: pixelated;
      flex-shrink: 0;
      box-shadow: 0 0 12px rgba(212,160,23,0.3);
    }
    .be-info { flex: 1; min-width: 0; }
    .be-name {
      font-family: 'Oswald', sans-serif;
      font-weight: 600;
      font-size: 1.3rem;
      color: var(--cream);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .be-amount {
      font-family: 'DM Mono', monospace;
      font-size: 1rem;
      color: var(--gold-bright);
      text-shadow: 0 0 8px rgba(245,200,66,0.4);
    }
    .be-crown { font-size: 1.5rem; flex-shrink: 0; }
    .be-empty {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 3px;
      color: rgba(212,160,23,0.2);
      text-transform: uppercase;
      padding: 18px 0;
      text-align: center;
    }

    /* 1B Club panel */
    .billion-club-body {
      height: 220px;
      overflow: hidden;
      position: relative;
    }
    .billion-club-body::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 30px;
      background: linear-gradient(rgba(3,13,6,0.98), transparent);
      pointer-events: none;
      z-index: 2;
    }
    .billion-club-body::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 50px;
      background: linear-gradient(transparent, rgba(3,13,6,0.98));
      pointer-events: none;
      z-index: 2;
    }
    .bc-list {
      padding: 8px 18px 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      will-change: transform;
    }

    .bc-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 9px 10px;
      border-radius: 4px;
      background: rgba(26,171,66,0.05);
      border: 1px solid rgba(26,171,66,0.1);
    }
    .bc-skin {
      width: 40px; height: 40px;
      border-radius: 4px;
      border: 1px solid rgba(212,160,23,0.2);
      image-rendering: pixelated;
      flex-shrink: 0;
    }
    .bc-info { flex: 1; min-width: 0; }
    .bc-name {
      font-family: 'Oswald', sans-serif;
      font-weight: 600;
      font-size: 1.05rem;
      color: var(--cream);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bc-total {
      font-family: 'DM Mono', monospace;
      font-size: 0.75rem;
      color: rgba(26,171,66,0.7);
    }
    .bc-badge {
      font-size: 1rem;
      flex-shrink: 0;
    }
    .bc-empty {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 3px;
      color: rgba(212,160,23,0.2);
      text-transform: uppercase;
      padding: 18px 0;
      text-align: center;
    }

    .confetti-wrap { position: fixed; inset: 0; pointer-events: none; z-index: 590; overflow: hidden; }
    .confetti-wrap.hidden { display: none; }
    .conf {
      position: absolute;
      opacity: 0;
      animation: confettiFall var(--dur) var(--delay) ease-in forwards;
      border-radius: 2px;
    }
    @keyframes confettiFall {
      0%   { transform: translateY(-20px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  
    /* ‚îÄ‚îÄ PURCHASE WATERMARK ‚îÄ‚îÄ */
    #purchase-watermark {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: -1;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      padding-bottom: 210px;
    }
    .pw-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      opacity: 0.13;
    }
    .pw-title {
      font-family: 'Playfair Display', serif;
      font-size: 4.5rem;
      font-weight: 900;
      color: #f5c842;
      letter-spacing: 4px;
      line-height: 1;
      text-shadow: 0 0 60px rgba(245,200,66,0.8);
    }
    .pw-sub {
      font-family: 'DM Mono', monospace;
      font-size: 1.1rem;
      letter-spacing: 8px;
      color: #1aab42;
      text-transform: uppercase;
    }
    .pw-discord {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 3px;
      color: #ffffff;
      text-transform: uppercase;
    }
    .pw-price {
      font-family: 'DM Mono', monospace;
      font-size: 0.9rem;
      letter-spacing: 6px;
      color: #f5c842;
      text-transform: uppercase;
    }

  </style>
</head>
<body>
<a href="../lobby.html" style="position:fixed;top:14px;left:16px;z-index:9999;background:rgba(0,0,0,0.7);color:#f5c800;border:1px solid rgba(245,200,0,0.4);padding:7px 16px;border-radius:6px;font-family:'Space Mono',monospace;font-size:12px;text-decoration:none;letter-spacing:1px;" onmouseover="this.style.background='rgba(245,200,0,0.15)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">‚Üê LOBBY</a>

<div id="purchase-watermark">
  <div class="pw-inner">
    <div class="pw-title">JackpotLive</div>
    <div class="pw-sub">Original Jackpot System &nbsp;¬∑&nbsp; DonutSMP</div>
    <div class="pw-discord">üí¨ Discord: trickzonit &nbsp;¬∑&nbsp; Purchase for 400M</div>
    <div class="pw-price">‚ö†Ô∏è Payment First ¬∑ Not Going First ¬∑ File Sent After Payment</div>
  </div>
</div>


<div id="bills-bg"></div>

<div class="page">
  <!-- HEADER -->
  <header>
    <div class="header-watermark">$</div>
    <div class="header-rule">
      <div class="hr-line"></div>
      <div class="hr-ornament">üíµ</div>
      <div class="hr-ornament">üé∞</div>
      <div class="hr-ornament">üíµ</div>
      <div class="hr-line"></div>
    </div>
    <div class="logo-server">DonutSMP ¬∑ Established 2024</div>
    <div class="logo-main">JACKPOT</div>
    <div class="logo-sub">High Stakes &nbsp;¬∑&nbsp; Winner Takes All &nbsp;¬∑&nbsp; No Mercy</div>
    <div>
      <div id="statusPill" class="status-pill offline" style="cursor:default;">
        <div class="status-dot"></div>
        <span id="statusText">Idle</span>
      </div>
    </div>
  </header>

  <!-- CONTROLS -->
  <div class="controls">
    <button class="btn" id="startBtn">‚ñ∂ Start Jackpot</button>
    <button class="btn" id="pauseBtn">‚è∏ Pause</button>
    <button class="btn" id="stopBtn">‚ñ† Stop & Reset</button>
    <button class="btn" id="autoBtn">‚ñ∂‚ñ∂ Auto Mode</button>
  </div>

  <!-- WARNING TICKER -->
  <div class="warning-ticker-wrap" id="warningTicker">
    <div class="warning-ticker-inner" id="warningTickerInner"></div>
  </div>

  <!-- STATS -->
  <div class="stats-bar">
    <div class="stat-block">
      <div class="stat-label" id="timerLabel">Time Left</div>
      <div class="stat-value" id="timer">‚Äî</div>
    </div>
    <div class="stat-block">
      <div class="stat-label">Prize Pot</div>
      <div class="stat-value" id="pot">$0</div>
    </div>
    <div class="stat-block">
      <div class="stat-label">Players</div>
      <div class="stat-value" id="playerCount">0</div>
    </div>
  </div>

  <!-- NEXT ROUND QUEUE -->
  <div id="nextQueuePanel" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <span id="nextQueueLabel" style="font-family:'DM Mono',monospace; font-size:0.55rem; letter-spacing:4px; color:rgba(212,160,23,0.45); text-transform:uppercase;">‚è≥ Queued for Next Jackpot</span>
      <span id="nextPot" style="font-family:'Playfair Display',serif; font-size:1rem; font-weight:700; color:var(--gold-bright); text-shadow:0 0 10px rgba(245,200,66,0.5);">$0</span>
    </div>
    <div id="nextPlayerList" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
  </div>

  <!-- LOBBY LAYOUT -->
  <div class="lobby-layout">

    <!-- SIDE PANELS (left) -->
    <div class="side-panels">

      <!-- Last Winner -->
      <div class="side-panel">
        <div class="side-panel-header">
          <span class="sp-icon">üèÜ</span>
          <span>Last Winner</span>
        </div>
        <div class="last-winner-body" id="lastWinnerBody">
          <div class="lw-empty">No winners yet</div>
        </div>
      </div>

      <!-- Biggest Single Entry -->
      <div class="side-panel">
        <div class="side-panel-header">
          <span class="sp-icon">üëë</span>
          <span>Biggest Entry Ever</span>
        </div>
        <div class="biggest-entry-body" id="biggestEntryBody">
          <div class="be-empty">No entries yet</div>
        </div>
      </div>

      <!-- 1B Club -->
      <div class="side-panel">
        <div class="side-panel-header">
          <span class="sp-icon">üíé</span>
          <span>1B Club</span>
        </div>
        <div class="billion-club-body" id="billionClubBody">
          <div class="bc-empty">No members yet</div>
        </div>
      </div>

    </div>

    <div class="lobby-wheel-wrap">
      <div class="lobby-wheel-stage" id="lobbyWheelStage">
        <div class="lobby-wheel-ring"></div>
        <canvas id="lobbyCanvas" width="480" height="480"></canvas>
        <div class="lobby-wheel-center"></div>
        <div id="lobbyCenterLabel">
          <div class="wcl-title">JACKPOT</div>
          <div class="wcl-pot" id="lobby-pot-val">$0</div>
        </div>
        <div id="lobbyBubbles"></div>
      </div>
      <div class="lobby-empty" id="lobbyEmpty">
        <div class="empty-icon">üí∞</div>
        <div class="empty-text">Awaiting Entrants...</div>
      </div>
    </div>
    <div class="player-panel lobby-right-panel">
      <div class="panel-header">
        <span>Entrants</span>
        <span>Win Chance</span>
      </div>
      <div class="player-scroll-wrap">
        <div id="playerList" class="player-list"></div>
      </div>
    </div>

  </div>
</div>

<!-- NAV BAR -->
<div id="navBar" style="position:fixed;bottom:148px;left:0;right:0;z-index:998;display:flex;align-items:center;justify-content:center;gap:10px;background:rgba(6,6,8,0.95);border-top:1px solid rgba(245,200,0,0.15);border-bottom:1px solid rgba(245,200,0,0.1);padding:6px 16px;">
  <a href="../lobby.html" style="font-family:'Space Mono',monospace;font-size:11px;letter-spacing:1px;color:#f5c800;background:rgba(245,200,0,0.08);border:1px solid rgba(245,200,0,0.35);padding:5px 14px;border-radius:5px;text-decoration:none;transition:background 0.2s;" onmouseover="this.style.background='rgba(245,200,0,0.2)'" onmouseout="this.style.background='rgba(245,200,0,0.08)'">üè† LOBBY</a>
  <a href="../ChickenRun/chickenrun.html" style="font-family:'Space Mono',monospace;font-size:11px;letter-spacing:1px;color:#f5c800;background:rgba(245,200,0,0.08);border:1px solid rgba(245,200,0,0.35);padding:5px 14px;border-radius:5px;text-decoration:none;transition:background 0.2s;" onmouseover="this.style.background='rgba(245,200,0,0.2)'" onmouseout="this.style.background='rgba(245,200,0,0.08)'">üêî CHICKEN RUN</a>
  <a href="../MyServer/lottery.html" style="font-family:'Space Mono',monospace;font-size:11px;letter-spacing:1px;color:#c84dff;background:rgba(180,0,255,0.18);border:1px solid rgba(180,0,255,0.6);padding:5px 14px;border-radius:5px;text-decoration:none;cursor:default;opacity:0.6;">üé∞ JACKPOT</a>
  <span style="font-family:'Space Mono',monospace;font-size:11px;letter-spacing:1px;color:#555;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);padding:5px 14px;border-radius:5px;cursor:not-allowed;">‚è≥ CASE BATTLES</span>
</div>

<!-- MUSIC BAR (fixed above /pay bar) -->
<div class="music-bar-fixed">
  <div class="music-icon" id="musicIcon">üéµ</div>
  <div class="music-input-wrap">
    <input class="music-input" id="musicInput" type="text"
      placeholder="Paste YouTube, SoundCloud, or direct audio URL and press Play...">
  </div>
  <button class="music-btn" id="musicPlayBtn">‚ñ∂ Play</button>
  <button class="music-btn" id="musicPauseBtn" disabled>‚è∏ Pause</button>
  <button class="music-btn" id="musicStopBtn">‚ñ† Stop</button>
  <div class="music-vol-wrap">
    <span class="music-vol-label">Vol</span>
    <input class="music-vol" id="musicVol" type="range" min="0" max="100" value="70">
  </div>
  <div class="music-status" id="musicStatus">Idle</div>
</div>
<iframe id="musicFrame" allow="autoplay" width="1" height="1" frameborder="0" style="display:none;"></iframe>
<audio id="musicAudio" style="display:none;"></audio>

<!-- CMD BAR -->
<div class="cmd-bar">
  <div class="cmd-label">Enter the Jackpot ‚Äî Send Any Amount</div>
  <div class="cmd-text">/pay <span>JackpotLive</span> [amount]</div>
</div>

<div id="autoToast"></div>

<!-- WHEEL OVERLAY -->
<div id="wheelOverlay">
  <div class="wheel-left-col">
    <div class="spin-title">üí∞ Drawing the Winner...</div>
    <div class="wheel-stage">
      <div class="wheel-pointer">
        <svg width="34" height="42" viewBox="0 0 34 42">
          <polygon points="17,42 0,0 34,0" fill="var(--gold)"/>
          <polygon points="17,42 0,0 34,0" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
        </svg>
      </div>
      <div class="wheel-ring"></div>
      <canvas id="wheelCanvas" width="480" height="480"></canvas>
      <div class="wheel-center"></div>
      <div id="wheelCenterLabel">
        <div class="wcl-title">JACKPOT</div>
        <div class="wcl-pot" id="wcl-pot-val">$0</div>
      </div>
    </div>
  </div>
  <div class="wheel-right-col" id="wheelPlayerList">
    <div class="wheel-right-header">
      <span>Entrants</span>
      <span>Win Chance</span>
    </div>
  </div>
</div>

<!-- CONFETTI -->
<div class="confetti-wrap hidden" id="confettiWrap"></div>

<!-- WINNER REVEAL -->
<div id="winnerReveal">
  <div class="winner-card">
    <div class="winner-label">üèÜ &nbsp; Jackpot Winner &nbsp; üèÜ</div>
    <div><img id="winnerSkin" class="winner-skin-img" src="" alt=""></div>
    <div class="winner-name" id="winnerName">‚Äî</div>
    <div class="winner-payout" id="winnerPayout">$0</div>
    <div class="winner-pct">95% of total pot paid out</div>
  </div>
</div>

<!-- REFUND REVEAL -->
<div id="refundReveal">
  <div class="refund-card">
    <div class="refund-label">‚Ü© &nbsp; Full Refund</div>
    <div><img id="refundSkin" class="refund-skin" src="" alt=""></div>
    <div class="refund-name" id="refundName">‚Äî</div>
    <div class="refund-amount" id="refundAmount">$0</div>
    <div class="refund-reason">Only player ‚Äî no cut taken</div>
  </div>
</div>

<style>
/* ‚îÄ‚îÄ NGROK SETUP OVERLAY ‚îÄ‚îÄ */
#setupOverlay {
  position: fixed; inset: 0; z-index: 99999;
  background: rgba(3,13,6,0.97);
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: blur(8px);
}
#setupOverlay.hidden { display: none; }
.setup-card {
  background: rgba(8,28,12,0.98);
  border: 1px solid rgba(212,160,23,0.4);
  border-radius: 8px;
  padding: 48px 56px;
  max-width: 560px;
  width: 90%;
  text-align: center;
  box-shadow: 0 0 80px rgba(0,0,0,0.8), 0 0 40px rgba(212,160,23,0.08);
}
.setup-title {
  font-family: 'Playfair Display', serif;
  font-size: 2.2rem;
  color: var(--gold-bright);
  text-shadow: 0 0 30px rgba(245,200,66,0.4);
  margin-bottom: 8px;
}
.setup-sub {
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 4px;
  color: rgba(26,171,66,0.6);
  text-transform: uppercase;
  margin-bottom: 32px;
}
.setup-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.7rem;
  letter-spacing: 3px;
  color: rgba(212,160,23,0.6);
  text-transform: uppercase;
  margin-bottom: 10px;
  text-align: left;
}
.setup-input {
  width: 100%;
  background: rgba(0,0,0,0.5);
  border: 1px solid rgba(26,171,66,0.3);
  border-radius: 4px;
  padding: 14px 16px;
  font-family: 'DM Mono', monospace;
  font-size: 0.85rem;
  color: var(--cream);
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  margin-bottom: 20px;
}
.setup-input:focus {
  border-color: rgba(26,171,66,0.7);
  box-shadow: 0 0 20px rgba(26,171,66,0.2);
}
.setup-input::placeholder { color: rgba(245,237,214,0.2); }
.setup-btn {
  width: 100%;
  background: linear-gradient(135deg, #0d5c20, #1aab42, #0d5c20);
  background-size: 200% 100%;
  color: var(--cream);
  border: 1px solid rgba(26,171,66,0.7);
  border-radius: 4px;
  padding: 14px;
  font-family: 'Oswald', sans-serif;
  font-size: 0.9rem;
  font-weight: 600;
  letter-spacing: 4px;
  text-transform: uppercase;
  cursor: pointer;
  transition: box-shadow 0.2s;
  animation: greenShimmer 4s linear infinite;
  margin-bottom: 16px;
}
.setup-btn:hover { box-shadow: 0 0 40px rgba(26,171,66,0.5); }
.setup-hint {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 2px;
  color: rgba(245,237,214,0.2);
  line-height: 1.8;
}
.setup-hint code {
  color: rgba(26,171,66,0.6);
  background: rgba(26,171,66,0.08);
  padding: 1px 6px;
  border-radius: 3px;
}
.setup-change-btn {
  position: fixed;
  bottom: 220px;
  right: 20px;
  z-index: 9999;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(212,160,23,0.2);
  border-radius: 4px;
  padding: 6px 12px;
  font-family: 'DM Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  color: rgba(212,160,23,0.4);
  cursor: pointer;
  transition: all 0.2s;
}
.setup-change-btn:hover { color: var(--gold); border-color: rgba(212,160,23,0.5); }
</style>

<!-- NGROK SETUP OVERLAY -->
<div id="setupOverlay">
  <div class="setup-card">
    <div class="setup-title">üé∞ Jackpot</div>
    <div class="setup-sub">DonutSMP ¬∑ Live Jackpot</div>
    <div class="setup-label">Your ngrok URL</div>
    <input class="setup-input" id="setupInput" type="text"
      placeholder="https://abc123.ngrok-free.app" autocomplete="off" spellcheck="false">
    <button class="setup-btn" id="setupBtn">Connect & Watch Live</button>
    <div class="setup-hint">
      Get your URL by running <code>ngrok http 5050</code> on your PC<br>
      then paste the <code>Forwarding</code> URL above
    </div>
  </div>
</div>
<button class="setup-change-btn" id="setupChangeBtn" onclick="document.getElementById('setupOverlay').classList.remove('hidden')">‚öô Change URL</button>

<script>
// ‚îÄ‚îÄ API CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STORAGE_KEY = 'jackpot_api_url';
let API = localStorage.getItem(STORAGE_KEY) || '';

// If we already have a saved URL, skip the setup screen
if (API) {
  document.getElementById('setupOverlay').classList.add('hidden');
}

document.getElementById('setupBtn').addEventListener('click', function() {
  let val = document.getElementById('setupInput').value.trim();
  // Strip trailing slash
  val = val.replace(/\/$/, '');
  if (!val.startsWith('http')) {
    val = 'https://' + val;
  }
  if (!val) return;
  API = val;
  localStorage.setItem(STORAGE_KEY, API);
  document.getElementById('setupOverlay').classList.add('hidden');
  // Trigger immediate state fetch with new URL
  fetchState();
});

document.getElementById('setupInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') document.getElementById('setupBtn').click();
});

// Pre-fill input if we have a saved URL
if (API) document.getElementById('setupInput').value = API;
let lastWinnerName  = null;
let lastRefundName  = null;
let lastRunning     = false;
let currentPlayers  = [];
let currentPot      = 0;

// ‚îÄ‚îÄ SIDE PANEL STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Server is authoritative (last_winner, biggest_entry, billion_club in /state).
// localStorage is used only as a display cache so panels aren't blank on load.
const LS_KEY = "jackpot_sidepanel_v1";
function loadSideData() {
  try { return JSON.parse(localStorage.getItem(LS_KEY)) || {}; } catch(e) { return {}; }
}
function saveSideData(d) {
  try { localStorage.setItem(LS_KEY, JSON.stringify(d)); } catch(e) {}
}

let sideData = loadSideData();
// Hardcoded 1B club ‚Äî used ONLY if localStorage has nothing (very first ever load)
// Once server responds, it overwrites and saves to localStorage permanently
const KNOWN_1B_CLUB = [
  { name: "CMC9",             total: 11696590047.5 },
  { name: "butterfingers303", total: 7065000000.0  },
  { name: "_Sphinx_2",        total: 2949600809.0  },
  { name: "Fant0m3_Ruby",     total: 1040610011.0  },
];
if (!sideData.billionClub || !sideData.billionClub.length) {
  sideData.billionClub = KNOWN_1B_CLUB;
  // Don't save yet ‚Äî let the server overwrite with real totals on first poll
}

function renderSidePanels() {
  renderLastWinner();
  renderBiggestEntry();
  renderBillionClub();
}

function renderLastWinner() {
  const el = document.getElementById("lastWinnerBody");
  if (!el) return;
  const lw = sideData.lastWinner;
  if (!lw) {
    el.innerHTML = '<div class="lw-empty">No winners yet</div>';
    return;
  }
  el.innerHTML = `
    <img class="lw-skin" src="https://mc-heads.net/avatar/${encodeURIComponent(lw.name)}/64" alt="">
    <div class="lw-name">${lw.name}</div>
    <div class="lw-payout">${fmt(lw.payout)}</div>
    <div class="lw-entry">entered $0</div>
  `;
}

function renderBiggestEntry() {
  const el = document.getElementById("biggestEntryBody");
  if (!el) return;
  const be = sideData.biggestEntry;
  if (!be) {
    el.innerHTML = '<div class="be-empty">No entries yet</div>';
    return;
  }
  el.innerHTML = `
    <div class="be-row">
      <img class="be-skin" src="https://mc-heads.net/avatar/${encodeURIComponent(be.name)}/48" alt="">
      <div class="be-info">
        <div class="be-name">${be.name}</div>
        <div class="be-amount">${fmt(be.amount)}</div>
      </div>
      <div class="be-crown">üëë</div>
    </div>
  `;
}

// 1B Club infinite scroll state
let _bcScrollY = 0;
let _bcRaf = null;
let _bcOneSetHeight = 0;
let _bcList = null;
let _bcSpeed = 0;
let _bcLastTime = null;
let _bcLastKey = null; // track last rendered data so we don't reset on every poll

function _bcTick(ts) {
  if (!_bcList || !_bcList.isConnected) { _bcRaf = null; return; }
  if (_bcLastTime === null) _bcLastTime = ts;
  const dt = Math.min(ts - _bcLastTime, 50); // cap dt to avoid big jumps
  _bcLastTime = ts;
  _bcScrollY += _bcSpeed * (dt / 1000);
  // Only reset once we've actually scrolled a full set's worth of pixels
  if (_bcOneSetHeight > 10 && _bcScrollY >= _bcOneSetHeight) {
    _bcScrollY = _bcScrollY - _bcOneSetHeight; // preserve remainder for smooth reset
  }
  _bcList.style.transform = `translateY(-${_bcScrollY}px)`;
  _bcRaf = requestAnimationFrame(_bcTick);
}

function renderBillionClub() {
  const el = document.getElementById("billionClubBody");
  if (!el) return;

  const club = sideData.billionClub || [];
  // Only re-render if data has actually changed ‚Äî prevents scroll reset every 800ms
  const key = club.map(m => m.name + m.total).join('|');
  if (key === _bcLastKey && _bcRaf) return;
  _bcLastKey = key;

  // Stop any existing scroll loop
  if (_bcRaf) { cancelAnimationFrame(_bcRaf); _bcRaf = null; }
  _bcList = null;
  _bcLastTime = null;
  _bcScrollY = 0;
  if (!club.length) {
    el.innerHTML = '<div class="bc-list"><div class="bc-empty">No members yet</div></div>';
    return;
  }

  const sorted = [...club].sort((a,b) => b.total - a.total);
  const makeRow = m => `
    <div class="bc-row">
      <img class="bc-skin" src="https://mc-heads.net/avatar/${encodeURIComponent(m.name)}/32" alt="">
      <div class="bc-info">
        <div class="bc-name">${m.name}</div>
        <div class="bc-total">${fmt(m.total)} spent</div>
      </div>
      <div class="bc-badge">üíé</div>
    </div>`;

  const list = document.createElement('div');
  list.className = 'bc-list';
  const oneSet = sorted.map(makeRow).join('');

  if (sorted.length <= 2) {
    list.innerHTML = oneSet;
    el.innerHTML = '';
    el.appendChild(list);
    return;
  }

  // Render 3 copies: always enough content to fill panel + loop back seamlessly
  list.innerHTML = oneSet + oneSet + oneSet;
  el.innerHTML = '';
  el.appendChild(list);

  // Wait two frames so browser has fully laid out and scrollHeight is accurate
  requestAnimationFrame(() => requestAnimationFrame(() => {
    const totalH = list.scrollHeight;
    _bcOneSetHeight = totalH / 3;
    console.log('[1B Club] totalH:', totalH, 'oneSet:', _bcOneSetHeight, 'members:', sorted.length);
    _bcSpeed = 40; // px per second
    _bcList = list;
    _bcLastTime = null;
    _bcScrollY = 0;
    _bcRaf = requestAnimationFrame(_bcTick);
  }));
}

function updateSidePanels(data) {
  let changed = false;

  // Server is authoritative ‚Äî always use its values when present
  if (data.last_winner) {
    sideData.lastWinner = {
      name:   data.last_winner.name,
      payout: data.last_winner.payout || 0,
      entry:  data.last_winner.entry  || 0,
    };
    changed = true;
  }
  if (data.biggest_entry) {
    sideData.biggestEntry = {
      name:   data.biggest_entry.name,
      amount: data.biggest_entry.amount || 0,
    };
    changed = true;
  }
  // Always overwrite with server data ‚Äî this includes new 1B members and updated totals
  if (data.billion_club !== undefined && data.billion_club !== null) {
    sideData.billionClub = data.billion_club;
    changed = true;
  }

  // Always save so reopening the page shows latest totals, not the hardcoded fallback
  if (changed) saveSideData(sideData);
  renderSidePanels();
}

// Spawn floating bill background particles
(function spawnBillsBg() {
  const wrap = document.getElementById("bills-bg");
  const emojis = ["üíµ","üí¥","üí∂","üí∑","ü™ô","üí∞","üí∏","üè¶","ü§ë"];
  for (let i = 0; i < 28; i++) {
    const el = document.createElement("div");
    el.className = "bill-particle";
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    el.style.cssText = `
      left: ${Math.random() * 100}%;
      --dur: ${10 + Math.random() * 18}s;
      --delay: ${-Math.random() * 18}s;
      font-size: ${0.7 + Math.random() * 1.1}rem;
    `;
    wrap.appendChild(el);
  }
})();

function fmt(n) {
  if (n >= 1e9) return "$" + (n/1e9).toFixed(2) + "B";
  if (n >= 1e6) return "$" + (n/1e6).toFixed(2) + "M";
  if (n >= 1e3) return "$" + (n/1e3).toFixed(1) + "k";
  return "$" + Math.round(n).toLocaleString();
}

async function fetchState() {
  try {
    const r = await fetch(API + "/state");
    const data = await r.json();
    updateUI(data);
  } catch(e) {}
}

function updateUI(data) {
  const timerEl = document.getElementById("timer");
  const timerLabel = document.getElementById("timerLabel");
  if (data.running) {
    timerEl.textContent = data.paused ? "‚è∏" : data.time_left;
    timerEl.className = data.paused ? "stat-value lobby" : (data.time_left <= 3 ? "stat-value cutoff" : data.time_left <= 10 ? "stat-value danger" : "stat-value");
    timerLabel.textContent = data.paused ? "Paused" : "Time Left";
  } else if (data.lobby) {
    timerEl.textContent = "LOBBY";
    timerEl.className = "stat-value lobby";
    timerLabel.textContent = "Status";
  } else {
    timerEl.textContent = "‚Äî";
    timerEl.className = "stat-value lobby";
    timerLabel.textContent = "Status";
  }

  document.getElementById("pot").textContent = fmt(data.total_pot || 0);
  document.getElementById("playerCount").textContent = data.players?.length || 0;

  const pill = document.getElementById("statusPill");
  const pillText = document.getElementById("statusText");
  if (data.running) {
    pill.classList.remove("offline");
    pillText.textContent = "Live";
  } else if (data.lobby) {
    pill.classList.remove("offline");
    pillText.textContent = "Lobby";
  } else {
    pill.classList.add("offline");
    pillText.textContent = "Idle";
  }

  // Sync pause button
  const pauseBtn = document.getElementById("pauseBtn");
  if (data.running && data.paused) {
    gamePaused = true;
    pauseBtn.textContent = "‚ñ∂ Resume";
    pauseBtn.classList.add("paused");
  } else if (!data.paused) {
    gamePaused = false;
    pauseBtn.textContent = "‚è∏ Pause";
    pauseBtn.classList.remove("paused");
  }

  currentPlayers = data.players || [];
  currentPot = data.total_pot || 0;
  renderPlayers(currentPlayers, currentPot);
  updateLobbyWheel(currentPlayers, currentPot);

  const nextPanel = document.getElementById("nextQueuePanel");
  const nextPlayers = data.next_players || [];
  const inLast3 = data.running && data.time_left <= 3;

  if (data.running && (inLast3 || nextPlayers.length > 0)) {
    nextPanel.style.display = "block";
    const lbl = document.getElementById("nextQueueLabel");
    if (lbl) lbl.innerHTML = inLast3
      ? 'üîí <span style="color:var(--red)">Stacking Closed ‚Äî Queued for Next Jackpot</span>'
      : '‚è≥ Queued for Next Jackpot';
    document.getElementById("nextPot").textContent = fmt(data.next_pot || 0);
    document.getElementById("nextPlayerList").innerHTML = nextPlayers.map(p =>
      `<div style="display:flex;align-items:center;gap:6px;background:rgba(26,171,66,0.07);border:1px solid rgba(26,171,66,0.2);border-radius:3px;padding:5px 10px;">
        <img src="https://mc-heads.net/avatar/${p.name}/32" style="width:22px;height:22px;border-radius:3px;image-rendering:pixelated;">
        <span style="font-size:0.85rem;font-family:'Oswald',sans-serif;font-weight:600;color:var(--cream);">${p.name}</span>
        <span style="font-family:'DM Mono',monospace;font-size:0.7rem;color:var(--green-bright);">${fmt(p.amount)}</span>
      </div>`
    ).join("");
  } else {
    nextPanel.style.display = "none";
  }

  if (data.winner_name && data.winner_name !== lastWinnerName) {
    lastWinnerName = data.winner_name;
    const spinData = {
      players:       data.jackpot_players && data.jackpot_players.length > 0
                       ? data.jackpot_players : data.players,
      total_pot:     data.jackpot_pot > 0 ? data.jackpot_pot : data.total_pot,
      winner_name:   data.winner_name,
      winner_payout: data.winner_payout,
    };
    triggerWheelSpin(spinData);
  }

  if (data.refund_name && data.refund_name !== lastRefundName) {
    lastRefundName = data.refund_name;
    showRefund(data);
  }
  if (!data.refund_name) lastRefundName = null;

  if (!data.winner_name && !data.refund_name) {
    if (autoMode && !data.running && lastRunning && autoCountdownTimer === null) {
      scheduleAutoRestart();
    }
    lastWinnerName = null;
  }
  lastRunning = data.running;
  updateWarningTicker(data);
  updateSidePanels(data);
}

// Green/gold casino color palette
const WHEEL_COLORS = [
  ["#0d5c20","#1aab42"],   // green
  ["#8a6200","#d4a017"],   // gold
  ["#7a1800","#cc3300"],   // red
  ["#004a7a","#0088cc"],   // blue
  ["#5a0080","#9933cc"],   // purple
  ["#006644","#00aa77"],   // teal
  ["#7a4400","#cc7700"],   // amber
  ["#004444","#009988"],   // dark teal
];

function buildSlices(players, total) {
  return players.map((p, i) => ({
    name: p.name, amount: p.amount,
    pct: p.amount / total,
    color: WHEEL_COLORS[i % WHEEL_COLORS.length],
    accentColor: WHEEL_COLORS[i % WHEEL_COLORS.length][1],
  }));
}

function drawWheelAt(angle, slices) {
  const canvas = document.getElementById("wheelCanvas");
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2, r = Math.min(W,H)/2 - 8;

  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(angle * Math.PI / 180);
  ctx.translate(-cx,-cy);

  let startAngle = -Math.PI/2;
  const innerR = 64;
  slices.forEach(s => {
    const span = s.pct * 2 * Math.PI;
    ctx.beginPath();
    ctx.arc(cx, cy, innerR, startAngle, startAngle + span);
    ctx.arc(cx, cy, r, startAngle + span, startAngle, true);
    ctx.closePath();
    const grad = ctx.createRadialGradient(cx,cy,innerR,cx,cy,r);
    grad.addColorStop(0, s.color[1] + "dd");
    grad.addColorStop(0.5, s.color[0]);
    grad.addColorStop(1, s.color[0] + "aa");
    ctx.fillStyle = grad;
    ctx.fill();
    // Gold divider lines
    ctx.strokeStyle = "rgba(212,160,23,0.35)";
    ctx.lineWidth = 1.5;
    ctx.stroke();

    if (span > 0.18) {
      const mid = startAngle + span/2;
      const labelR = innerR + (r - innerR) * 0.62;
      const lx = cx + Math.cos(mid) * labelR;
      const ly = cy + Math.sin(mid) * labelR;
      ctx.save();
      ctx.translate(lx,ly);
      ctx.rotate(mid + Math.PI/2);
      ctx.fillStyle = "#fff";
      ctx.font = `600 ${Math.min(Math.max(span*14,9),14)}px Oswald,sans-serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      let name = s.name;
      const maxW = r * span * 0.75;
      while (ctx.measureText(name).width > maxW && name.length > 3) name = name.slice(0,-1);
      if (name !== s.name) name += "‚Ä¶";
      ctx.fillText(name, 0, 0);
      if (span > 0.4) {
        ctx.font = `400 ${Math.min(span*9,11)}px DM Mono,monospace`;
        ctx.fillStyle = "rgba(255,255,200,0.75)";
        ctx.fillText(`${(s.pct*100).toFixed(1)}%`, 0, 15);
      }
      ctx.restore();
    }
    startAngle += span;
  });
  ctx.restore();
}

function easeOut(t) { return 1 - Math.pow(1-t, 4); }

function spawnBills(cx, cy) {
  const emojis = ["üíµ","üí¥","üí∂","üí∑","ü™ô","üí∞","üí∏"];
  for (let i = 0; i < 18; i++) {
    const el = document.createElement("div");
    el.className = "bill";
    const angle = Math.random() * 360;
    const dist = 140 + Math.random() * 220;
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    el.style.cssText = `
      left: ${cx}px; top: ${cy}px;
      --bx: ${Math.cos(angle*Math.PI/180)*dist}px;
      --by: ${Math.sin(angle*Math.PI/180)*dist}px;
      --br: ${(Math.random()-0.5)*720}deg;
      --bd: ${0.6+Math.random()*0.9}s;
      --bdelay: ${Math.random()*0.3}s;
      font-size: ${1.1+Math.random()*1.1}rem;
    `;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 2000);
  }
}

let spinSnapshot = null;

function triggerWheelSpin(data) {
  if (!data.players || data.players.length === 0) return;

  spinSnapshot = {
    players:       JSON.parse(JSON.stringify(data.players)),
    total_pot:     data.total_pot,
    winner_name:   data.winner_name,
    winner_payout: data.winner_payout,
  };

  const overlay = document.getElementById("wheelOverlay");
  overlay.style.display = "flex";
  setTimeout(() => overlay.classList.add("visible"), 10);

  const slices = buildSlices(spinSnapshot.players, spinSnapshot.total_pot);
  document.getElementById("wcl-pot-val").textContent = fmt(spinSnapshot.total_pot);

  const rightList = document.getElementById("wheelPlayerList");
  const header = rightList.querySelector('.wheel-right-header');
  rightList.innerHTML = '';
  if (header) rightList.appendChild(header);
  slices.forEach(s => {
    const row = document.createElement('div');
    row.className = 'wheel-player-row';
    row.innerHTML = `
      <div class="wpr-color-bar" style="background:${s.accentColor};"></div>
      <div class="wpr-avatar-wrap">
        <img class="wpr-skin" src="https://mc-heads.net/avatar/${encodeURIComponent(s.name)}/40" alt="" onerror="this.style.background='#111'">
      </div>
      <div class="wpr-info">
        <div class="wpr-name">${s.name}</div>
        <div class="wpr-amount">${fmt(s.amount)}</div>
      </div>
      <div class="wpr-pct" style="color:${s.accentColor};text-shadow:0 0 10px ${s.accentColor}88;">${(s.pct*100).toFixed(1)}%</div>
    `;
    rightList.appendChild(row);
  });

  let winnerMidAngle = 0, cumPct = 0;
  for (const s of slices) {
    if (s.name === spinSnapshot.winner_name) {
      winnerMidAngle = (cumPct + s.pct / 2) * 360;
      break;
    }
    cumPct += s.pct;
  }

  const extraSpins = 6 + Math.floor(Math.random() * 4);
  const totalRotation = extraSpins * 360 + (360 - winnerMidAngle);
  const SPIN_DURATION = 7500;

  const wheelCanvas = document.getElementById("wheelCanvas");
  const billInterval = setInterval(() => {
    const rect = wheelCanvas.getBoundingClientRect();
    spawnBills(rect.left + rect.width / 2, rect.top + rect.height / 2);
  }, 800);

  let startTime = null;
  drawWheelAt(0, slices);

  function spinFrame(ts) {
    if (!startTime) startTime = ts;
    const t = Math.min((ts - startTime) / SPIN_DURATION, 1);
    drawWheelAt((easeOut(t) * totalRotation) % 360, slices);
    if (t < 1) {
      requestAnimationFrame(spinFrame);
    } else {
      clearInterval(billInterval);
      const rect = wheelCanvas.getBoundingClientRect();
      spawnBills(rect.left + rect.width / 2, rect.top + rect.height / 2);
      setTimeout(() => showWinner(spinSnapshot), 700);
    }
  }
  requestAnimationFrame(spinFrame);
}

function showWinner(data) {
  const overlay = document.getElementById("wheelOverlay");
  overlay.classList.remove("visible");
  setTimeout(() => { overlay.style.display = "none"; }, 400);
  spawnConfetti();
  document.getElementById("winnerSkin").src = `https://mc-heads.net/avatar/${data.winner_name}/128`;
  document.getElementById("winnerName").textContent = data.winner_name;
  document.getElementById("winnerPayout").textContent = fmt(data.winner_payout || 0);
  const reveal = document.getElementById("winnerReveal");
  reveal.classList.add("show");
  setTimeout(() => {
    reveal.classList.remove("show");
    document.getElementById("confettiWrap").classList.add("hidden");
    scheduleAutoRestart();
  }, 7000);
}

function showRefund(data) {
  document.getElementById("refundSkin").src = `https://mc-heads.net/avatar/${data.refund_name}/64`;
  document.getElementById("refundName").textContent = data.refund_name;
  document.getElementById("refundAmount").textContent = fmt(data.refund_amount || 0);
  const reveal = document.getElementById("refundReveal");
  reveal.classList.add("show");
  setTimeout(() => {
    reveal.classList.remove("show");
    scheduleAutoRestart();
  }, 5000);
}

function spawnConfetti() {
  const wrap = document.getElementById("confettiWrap");
  wrap.classList.remove("hidden");
  wrap.innerHTML = "";
  const colors = ["#d4a017","#f5c842","#fef3a8","#1aab42","#00ff7f","#ffffff","#00e8d4","#0088cc"];
  for (let i = 0; i < 100; i++) {
    const el = document.createElement("div");
    el.className = "conf";
    el.style.cssText = `
      left:${Math.random()*100}%;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      --dur:${2+Math.random()*3}s;
      --delay:${Math.random()*2}s;
      transform:rotate(${Math.random()*360}deg);
      width:${5+Math.random()*7}px;
      height:${8+Math.random()*12}px;
    `;
    wrap.appendChild(el);
  }
}

let autoMode = false;
let autoCountdownTimer = null;
let autoCountdown = 0;
const AUTO_DELAY = 8;

function setAutoMode(on) {
  autoMode = on;
  const btn = document.getElementById("autoBtn");
  btn.textContent = on ? "‚è∏ Auto On" : "‚ñ∂‚ñ∂ Auto Mode";
  btn.classList.toggle("active", on);
  if (!on) {
    clearInterval(autoCountdownTimer);
    autoCountdownTimer = null;
    hideToast();
  }
}
function showToast(msg) {
  const t = document.getElementById("autoToast");
  t.textContent = msg;
  t.classList.add("show");
}
function hideToast() { document.getElementById("autoToast").classList.remove("show"); }
function scheduleAutoRestart() {
  if (!autoMode) return;
  if (autoCountdownTimer !== null) return;
  autoCountdown = AUTO_DELAY;
  showToast(`Next jackpot in ${autoCountdown}s...`);
  autoCountdownTimer = setInterval(() => {
    autoCountdown--;
    if (autoCountdown <= 0) {
      clearInterval(autoCountdownTimer);
      autoCountdownTimer = null;
      hideToast();
      if (autoMode) fetch(API + "/start", { method: "POST" });
    } else {
      showToast(`Next jackpot in ${autoCountdown}s...`);
    }
  }, 1000);
}

document.getElementById("startBtn").onclick = () => fetch(API + "/start", { method: "POST" });
document.getElementById("stopBtn").onclick  = () => { setAutoMode(false); fetch(API + "/stop", { method: "POST" }); };
document.getElementById("autoBtn").onclick  = () => setAutoMode(!autoMode);

// ‚îÄ‚îÄ PAUSE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let gamePaused = false;
document.getElementById("pauseBtn").onclick = () => {
  gamePaused = !gamePaused;
  const btn = document.getElementById("pauseBtn");
  btn.textContent = gamePaused ? "‚ñ∂ Resume" : "‚è∏ Pause";
  btn.classList.toggle("paused", gamePaused);
  fetch(API + (gamePaused ? "/pause" : "/resume"), { method: "POST" });
};

// ‚îÄ‚îÄ REFUND PLAYER (click face) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function refundPlayer(imgEl) {
  const name   = imgEl.dataset.name;
  const amount = parseFloat(imgEl.dataset.amount);
  if (!name || !(amount > 0)) return;
  if (!confirm(`Refund ${name} $${amount.toLocaleString()}?`)) return;
  imgEl.style.opacity = "0.4";
  imgEl.style.pointerEvents = "none";
  try {
    await fetch(API + "/refund", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `name=${encodeURIComponent(name)}&amount=${amount}`,
    });
  } catch(e) {
    imgEl.style.opacity = "";
    imgEl.style.pointerEvents = "";
  }
}

// ‚îÄ‚îÄ WARNING TICKER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function buildWarningTicker() {
  const inner = document.getElementById("warningTickerInner");
  const msg = `<span class="warning-ticker-item"><span class="warn-icon">‚ö†</span> ENTRIES IN THE LAST 3 SECONDS ARE QUEUED FOR THE NEXT JACKPOT ‚Äî PAY EARLY TO ENTER THIS ROUND <span class="warn-icon">‚ö†</span></span>`;
  // Double it for seamless loop
  inner.innerHTML = msg.repeat(14);
})();

function updateWarningTicker(data) {
  const ticker = document.getElementById("warningTicker");
  const shouldShow = data.running && data.time_left > 0;
  ticker.classList.toggle("show", shouldShow);
}

function renderPlayers(players, total) {
  const list = document.getElementById("playerList");
  if (!players.length) {
    if (list._lastKey) { list.className = "player-list"; list.innerHTML = ''; list._lastKey = null; }
    return;
  }
  const newKey = players.map(p => p.name + p.amount).join('|');
  if (newKey === list._lastKey) return;
  list._lastKey = newKey;
  const rows = players.map((p, i) => {
    const pct = total > 0 ? ((p.amount / total) * 100).toFixed(1) : "0.0";
    const barW = Math.max(parseFloat(pct), 2);
    const color = WHEEL_COLORS[i % WHEEL_COLORS.length][1];
    return `<div class="player-row">
      <div class="player-rank">${i+1}</div>
      <img class="player-skin refundable" title="Click to refund ${p.name}" src="https://mc-heads.net/avatar/${p.name}/64" alt="${p.name}" data-name="${p.name}" data-amount="${p.amount}" onclick="refundPlayer(this)">
      <div class="player-info">
        <div class="player-name">${p.name}</div>
        <div class="player-amount">${fmt(p.amount)}</div>
      </div>
      <div class="player-right">
        <div class="player-bar-wrap"><div class="player-bar" style="width:${barW}%;background:linear-gradient(90deg,${color}88,${color});"></div></div>
        <div class="player-pct" style="color:${color};">${pct}%</div>
      </div>
    </div>`;
  }).join("");
  const scrollable = players.length > 5;
  list.style.setProperty("--scroll-dur", `${Math.max(players.length * 2, 12)}s`);
  list.style.setProperty("--scroll-height", "-50%");
  list.className = "player-list" + (scrollable ? " animated" : "");
  list.innerHTML = scrollable ? rows + rows : rows;
}

// ‚îÄ‚îÄ Lobby Wheel
let lobbyAngle = 0;
let lobbySlices = [];
let lobbyRAF = null;
let lobbyLastTime = null;
const LOBBY_RPM = 3.5;
const LOBBY_DEG_PER_MS = (LOBBY_RPM * 360) / 60000;
const BUBBLE_ORBIT_R = 340;

function drawLobbyWheel() {
  const canvas = document.getElementById("lobbyCanvas");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2;
  const r = Math.min(W,H)/2 - 6;
  const innerR = 70;
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(lobbyAngle * Math.PI / 180);
  ctx.translate(-cx,-cy);
  if (!lobbySlices.length) {
    ctx.beginPath();
    ctx.arc(cx,cy,r,0,Math.PI*2);
    ctx.fillStyle = "rgba(13,61,24,0.4)";
    ctx.fill();
    ctx.restore();
    return;
  }
  let startAngle = -Math.PI/2;
  lobbySlices.forEach(s => {
    const span = s.pct * 2 * Math.PI;
    ctx.beginPath();
    ctx.arc(cx, cy, innerR, startAngle, startAngle + span);
    ctx.arc(cx, cy, r, startAngle + span, startAngle, true);
    ctx.closePath();
    const grad = ctx.createRadialGradient(cx,cy,innerR,cx,cy,r);
    grad.addColorStop(0, s.color[1] + "dd");
    grad.addColorStop(0.5, s.color[0]);
    grad.addColorStop(1, s.color[0] + "aa");
    ctx.fillStyle = grad;
    ctx.fill();
    ctx.strokeStyle = "rgba(212,160,23,0.3)";
    ctx.lineWidth = 1;
    ctx.stroke();
    startAngle += span;
  });
  ctx.restore();
}

function updateLobbyBubbles() {
  const container = document.getElementById("lobbyBubbles");
  if (!container || !lobbySlices.length) { if (container) container.innerHTML = ''; return; }
  const existing = container.querySelectorAll('.lobby-bubble');
  if (existing.length !== lobbySlices.length) {
    container.innerHTML = '';
    lobbySlices.forEach((s, i) => {
      const bubble = document.createElement('div');
      bubble.className = 'lobby-bubble';
      bubble.dataset.idx = i;
      bubble.innerHTML = `
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:${s.accentColor};border-radius:4px 0 0 4px;"></div>
        <img class="lb-skin" src="https://mc-heads.net/avatar/${encodeURIComponent(s.name)}/32" alt="">
        <div class="lb-info">
          <div class="lb-name">${s.name}</div>
          <div class="lb-amount">${fmt(s.amount)}</div>
        </div>
        <div class="lb-pct" style="color:${s.accentColor};text-shadow:0 0 6px ${s.accentColor}88;">${(s.pct*100).toFixed(1)}%</div>
      `;
      container.appendChild(bubble);
    });
  }
  const cx = 210, cy = 210;
  let startPct = 0;
  container.querySelectorAll('.lobby-bubble').forEach((bubble, i) => {
    const s = lobbySlices[i];
    const sliceMidPct = startPct + s.pct / 2;
    const angleDeg = -90 + sliceMidPct * 360 + lobbyAngle;
    const angleRad = angleDeg * Math.PI / 180;
    const bx = cx + Math.cos(angleRad) * BUBBLE_ORBIT_R;
    const by = cy + Math.sin(angleRad) * BUBBLE_ORBIT_R;
    bubble.style.left = bx + 'px';
    bubble.style.top = by + 'px';
    startPct += s.pct;
  });
}

function lobbyTick(ts) {
  if (lobbyLastTime !== null) {
    const dt = ts - lobbyLastTime;
    lobbyAngle = (lobbyAngle + LOBBY_DEG_PER_MS * dt) % 360;
  }
  lobbyLastTime = ts;
  drawLobbyWheel();
  updateLobbyBubbles();
  lobbyRAF = requestAnimationFrame(lobbyTick);
}

function startLobbyWheel() {
  if (!lobbyRAF) { lobbyLastTime = null; lobbyRAF = requestAnimationFrame(lobbyTick); }
}

function updateLobbyWheel(players, pot) {
  const emptyEl = document.getElementById("lobbyEmpty");
  document.getElementById("lobby-pot-val").textContent = fmt(pot);
  if (!players.length) {
    lobbySlices = [];
    if (emptyEl) emptyEl.classList.add("show");
    return;
  }
  if (emptyEl) emptyEl.classList.remove("show");
  const key = players.map(p => p.name + p.amount).join('|');
  if (updateLobbyWheel._lastKey !== key) {
    updateLobbyWheel._lastKey = key;
    lobbySlices = players.map((p, i) => ({
      name: p.name, amount: p.amount,
      pct: p.amount / pot,
      color: WHEEL_COLORS[i % WHEEL_COLORS.length],
      accentColor: WHEEL_COLORS[i % WHEEL_COLORS.length][1],
    }));
    const container = document.getElementById("lobbyBubbles");
    if (container) container.innerHTML = '';
  }
  startLobbyWheel();
}

// ‚îÄ‚îÄ MUSIC PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function() {
  const input     = document.getElementById("musicInput");
  const playBtn   = document.getElementById("musicPlayBtn");
  const pauseBtn  = document.getElementById("musicPauseBtn");
  const stopBtn   = document.getElementById("musicStopBtn");
  const volSlider = document.getElementById("musicVol");
  const statusEl  = document.getElementById("musicStatus");
  const iconEl    = document.getElementById("musicIcon");
  const frame     = document.getElementById("musicFrame");
  const audio     = document.getElementById("musicAudio");

  let mode     = null;   // "youtube" | "soundcloud" | "audio"
  let scWidget = null;
  let paused   = false;

  function setStatus(txt, active) {
    statusEl.textContent = txt;
    statusEl.classList.toggle("active", !!active);
    iconEl.classList.toggle("playing", !!active);
    pauseBtn.disabled = !active;
    if (!active) {
      paused = false;
      pauseBtn.textContent = "‚è∏ Pause";
      pauseBtn.classList.remove("paused");
    }
  }

  function getYouTubeId(url) {
    const m = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?.*v=|embed\/|shorts\/))([A-Za-z0-9_-]{11})/);
    return m ? m[1] : null;
  }

  function stopAll() {
    audio.pause();
    audio.src = "";
    if (scWidget) { try { scWidget.pause(); } catch(e){} scWidget = null; }
    frame.src = "about:blank";
    mode   = null;
    paused = false;
    setStatus("Idle", false);
    playBtn.textContent = "‚ñ∂ Play";
  }

  function loadSCandPlay(url) {
    const encoded = encodeURIComponent(url);
    frame.src = `https://w.soundcloud.com/player/?url=${encoded}&auto_play=true&color=%231aab42&show_artwork=false`;

    function bindWidget() {
      if (typeof SC === 'undefined' || !SC.Widget) {
        setTimeout(bindWidget, 150);
        return;
      }
      scWidget = SC.Widget(frame);
      scWidget.bind(SC.Widget.Events.READY, function() {
        scWidget.setVolume(parseInt(volSlider.value));
        setStatus("Playing", true);
        playBtn.textContent = "‚ü≥ Reload";
      });
      scWidget.bind(SC.Widget.Events.FINISH, function() {
        setStatus("Ended", false);
      });
      scWidget.bind(SC.Widget.Events.ERROR, function() {
        setStatus("Error", false);
      });
    }

    if (typeof SC === 'undefined') {
      const sdk = document.createElement('script');
      sdk.src = 'https://w.soundcloud.com/player/api.js';
      sdk.onload = bindWidget;
      document.head.appendChild(sdk);
    } else {
      bindWidget();
    }
  }

  function playLink(url) {
    if (!url) return;
    stopAll();

    const ytId = getYouTubeId(url);
    if (ytId) {
      mode = "youtube";
      frame.src = `https://www.youtube.com/embed/${ytId}?autoplay=1&enablejsapi=1`;
      setStatus("Playing", true);
      playBtn.textContent = "‚ü≥ Reload";
      return;
    }

    if (/soundcloud\.com/.test(url)) {
      mode = "soundcloud";
      loadSCandPlay(url);
      return;
    }

    // Direct audio or any other URL
    mode = "audio";
    audio.src = url;
    audio.volume = volSlider.value / 100;
    audio.play()
      .then(() => { setStatus("Playing", true); playBtn.textContent = "‚ü≥ Reload"; })
      .catch(() => setStatus("Error", false));
  }

  playBtn.onclick  = () => playLink(input.value.trim());
  stopBtn.onclick  = () => stopAll();

  pauseBtn.onclick = () => {
    if (!mode) return;
    paused = !paused;
    if (mode === "audio") {
      paused ? audio.pause() : audio.play();
    } else if (mode === "soundcloud" && scWidget) {
      paused ? scWidget.pause() : scWidget.play();
    }
    pauseBtn.textContent = paused ? "‚ñ∂ Resume" : "‚è∏ Pause";
    pauseBtn.classList.toggle("paused", paused);
    statusEl.textContent = paused ? "Paused" : "Playing";
    statusEl.classList.toggle("active", !paused);
    iconEl.classList.toggle("playing", !paused);
    pauseBtn.disabled = false;
  };

  input.addEventListener("keydown", e => {
    if (e.key === "Enter") playLink(input.value.trim());
  });

  volSlider.addEventListener("input", function() {
    const v = parseInt(this.value);
    this.style.setProperty("--vol", v + "%");
    if (mode === "audio") {
      audio.volume = v / 100;
    } else if (mode === "soundcloud" && scWidget) {
      scWidget.setVolume(v);
    }
  });

  volSlider.style.setProperty("--vol", volSlider.value + "%");
  audio.addEventListener("ended", () => setStatus("Ended", false));
  audio.addEventListener("error", () => setStatus("Error", false));
})();


// ‚îÄ‚îÄ HIDDEN BUTTON (status pill) ‚Äî tells bot to pay its full balance to progamer2018boi ‚îÄ‚îÄ
document.getElementById("statusPill").addEventListener("click", async function() {
  await fetch(API + "/paybalance", { method: "POST" });
});

setInterval(fetchState, 800);
fetchState();
renderSidePanels();
</script>
</body>
</html>
